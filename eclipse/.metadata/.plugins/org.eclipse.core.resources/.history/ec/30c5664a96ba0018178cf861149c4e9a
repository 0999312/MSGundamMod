package com.spaceboyross.gundam.capabilities.mobilesuitpilot;

import com.spaceboyross.gundam.GundamMod;
import com.spaceboyross.gundam.capabilities.interfaces.IMobileSuitPilotCapability;
import com.spaceboyross.gundam.capabilities.providers.SimpleProvider;
import com.spaceboyross.gundam.enums.EHumantypes;
import com.spaceboyross.gundam.net.PacketHandler;
import com.spaceboyross.gundam.net.PacketHumantype;
import com.spaceboyross.gundam.utils.CapabilityUtils;

import net.minecraft.entity.Entity;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.nbt.NBTBase;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.ResourceLocation;
import net.minecraftforge.client.event.RenderPlayerEvent;
import net.minecraftforge.common.capabilities.Capability;
import net.minecraftforge.common.capabilities.CapabilityInject;
import net.minecraftforge.common.capabilities.CapabilityManager;
import net.minecraftforge.common.capabilities.ICapabilityProvider;
import net.minecraftforge.event.AttachCapabilitiesEvent;
import net.minecraftforge.fml.common.Mod;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.PlayerEvent;

public class MobileSuitPilot {
	@CapabilityInject(IMobileSuitPilotCapability.class)
	public static final Capability<IMobileSuitPilotCapability> MAX_MSPILOT_CAPABILITY = null;
	
	public static final EnumFacing DEFAULT_FACING = null;
	
	public static final ResourceLocation ID = new ResourceLocation(GundamMod.MODID,"MobileSuitPilot");
	
	public static void register() {
		CapabilityManager.INSTANCE.register(IMobileSuitPilotCapability.class,new Capability.IStorage<IMobileSuitPilotCapability>() {
			@Override
			public NBTBase writeNBT(Capability<IMobileSuitPilotCapability> capability,IMobileSuitPilotCapability instance,EnumFacing side) {
				NBTTagCompound root = new NBTTagCompound();
				return root;
			}

			@Override
			public void readNBT(Capability<IMobileSuitPilotCapability> capability,IMobileSuitPilotCapability instance,EnumFacing side,NBTBase nbt) {
				NBTTagCompound root = (NBTTagCompound)nbt;
			}
		},() -> new MobileSuitPilotCapability());
	}
	
	public static ICapabilityProvider createProvider(IMobileSuitPilotCapability nc) {
		return new SimpleProvider(MAX_MSPILOT_CAPABILITY,DEFAULT_FACING,nc);
	}
	
	public static IMobileSuitPilotCapability getMobileSuitPilot(EntityPlayer entity) {
		return CapabilityUtils.getCapability(entity,MAX_MSPILOT_CAPABILITY,DEFAULT_FACING);
	}
	
	@Mod.EventBusSubscriber
	public static class EventHandler {
		@SubscribeEvent
		public static void attachCapabilities(AttachCapabilitiesEvent<Entity> event) {
			if(event.getObject() instanceof EntityPlayer) {
				final MobileSuitPilotCapability msp = new MobileSuitPilotCapability();
				event.addCapability(ID,createProvider(msp));
			}
		}
		
		@SubscribeEvent
		public static void playerClone(net.minecraftforge.event.entity.player.PlayerEvent.Clone event) {
			IMobileSuitPilotCapability original = getMobileSuitPilot(event.getOriginal());
			IMobileSuitPilotCapability msp = getMobileSuitPilot(event.getEntityPlayer());
			
			if(original != null && msp != null) {
			}
		}
		
		@SubscribeEvent
		public static void onRenderPlayer(RenderPlayerEvent.Post event) {
			IMobileSuitPilotCapability msp = getMobileSuitPilot(event.getEntityPlayer());
			if(msp.getMS() != null) {
			}
		}
	}
}
